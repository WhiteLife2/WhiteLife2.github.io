<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="study life"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>第一个ndk程序 - alonealice</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com/earthWo"><span>Github</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="https://img.zcool.cn/community/014177554b6ae7000001bf729a3698.jpg@1280w_1l_0o_100sh.jpg"><div class="post-title"><h1 class="title">第一个ndk程序</h1><ul class="meta"><li><i class="icon icon-author"></i>alonealice</li><li><i class="icon icon-clock"></i>3 Minutes</li><li><i class="icon icon-calendar"></i>2016年6月14日</li></ul></div></div><div class="article-content" style="max-width:800px"><p>之前写过一个如何创建ndk程序并且调用相关的c语言方法，虽然方法是可行的，但是过程怎么看都别扭，都有一种投机取巧的感觉。查阅网上的相关资料，资料虽多，但是不是写的很复杂，就是时间太久了无法再适用了。哎，第三方资料都靠不住呀，只能看官方资料了。<br>官方资料其实很简单，而且基于 Android Studio 2.2 或者更高的版本，同时要求 Gradle version 2.2.0 或更高的版本。<br>现在来看看怎样编写第一个ndk程序。<br>首先要先下载一些工具包，这些都可以在sdk manager中下载。<br><img src="http://7xjrms.com1.z0.glb.clouddn.com/ndk-install_2-2_2x.png" alt><br>这三个包的主要用途如下：<br><code>ndk</code>:NDK 提供了一系列的工具，帮助开发者快速开发 C（或C++）的动态库，并能自动将 so 和 java 应用一起打包成 apk。这些工具对开发者的帮助是巨大的。<br><code>CMake</code>:一个外部的构建工具，与Gradle一起构建native库，如果你使用ndk-build就不需要下载它，在这里我使用CMake创建native库。<br><code>LLDB</code>:调试native代码工具。<br> 在下载了上面三个库之后，如果你需要新建一个项目，那你只需要在创建项目的时候，选择<code>include C++ Support</code>选项，之后Android Studio就会帮你做好所有的事。在创建的新工程中，在main中有一个cpp文件夹，里面有<code>mative-lib.cpp</code>文件。同时在module目录中有一个<code>CMakeLists.txt</code>文件。你可以直接运行程序。<br> 如果你需在在原项目的基础上添加ndk支持，又要怎么做呢？<br> 1.在下载了那三个工具的情况下，在main目录下添加一个文件夹（cpp）。<br> 2.创建一个C/C++ Source File文件，里面添加c代码：(例子)<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;jni.h&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line"></span><br><span class="line">extern &quot;C&quot;</span><br><span class="line">JNIEXPORT jstring</span><br><span class="line"></span><br><span class="line">JNICALL</span><br><span class="line">Java_library_whitelife_hellojni_JniUtil_getString(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject /* this */) &#123;</span><br><span class="line">    std::string hello = &quot;哈哈哈哈&quot;;</span><br><span class="line">    return env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> 3.在module的根目录下创建<code>CMakeLists.txt</code>，注意一定要这样命名命名<br> 4.里面添加相关内容<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> cmake_minimum_required(VERSION 3.4.1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add_library( # library名字.</span><br><span class="line">             native-lib</span><br><span class="line"></span><br><span class="line">             # Sets the library as a shared library.</span><br><span class="line">             SHARED</span><br><span class="line"></span><br><span class="line">             # 之前cpp文件的具体地址.</span><br><span class="line">             src/main/cpp/native-lib.cpp )</span><br></pre></td></tr></table></figure></p>
<p> 5.最后在module的<code>build.gradle</code>的android中添加相关支持<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">externalNativeBuild &#123;</span><br><span class="line">       cmake &#123;</span><br><span class="line">           path &quot;CMakeLists.txt&quot;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p> 6.最后在java代码中调用库和方法<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> public class JniUtil &#123;</span><br><span class="line"></span><br><span class="line">    public native String getString();</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        System.loadLibrary(&quot;native-lib&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> 运行相关代码就可以调用c程序方法<br> <code>((TextView)findViewById(R.id.tv_text)).
 setText(new JniUtil().getString());</code></p>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/NDK/">NDK</a><span class="tag-list-count">1</span></li></ul></div><div class="categories"><i class="icon icon-category"></i><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/NDK/">NDK</a><span class="category-list-count">1</span></li></ul></div></div><div class="article-comment" style="max-width:800px"><div class="ds-thread" id="ds-thread" data-thread-key="ck85r4tee0030c7o1zlm7q1c9" data-title="第一个ndk程序" data-url="https://earthwo.github.io/2016/06/14/第一个jni程序/" site-name="ueibo"></div><script>var siteName = document.getElementById('ds-thread').getAttribute('site-name');
var duoshuoQuery = {short_name: siteName};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2016/07/23/AsyncTask解析/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2016/06/13/AIDL简单入门/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/earthWo" title="Github" target="_blank"><i class="icon icon-github"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2020 alonealice<br><small><a href="http://www.miitbeian.gov.cn/" target="_blank">浙ICP备17033688号</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>