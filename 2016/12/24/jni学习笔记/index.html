<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="study life"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>NDK学习笔记(一) - alonealice</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com/earthWo"><span>Github</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="https://img.zcool.cn/community/014177554b6ae7000001bf729a3698.jpg@1280w_1l_0o_100sh.jpg"><div class="post-title"><h1 class="title">NDK学习笔记(一)</h1><ul class="meta"><li><i class="icon icon-author"></i>alonealice</li><li><i class="icon icon-clock"></i>3 Minutes</li><li><i class="icon icon-calendar"></i>2016年12月24日</li></ul></div></div><div class="article-content" style="max-width:800px"><p>在Android开发中，使用NDK开发越来越重要。如何在android studio中使用NDK开发，这里不再介绍，可以参考<a href="http://whitelife.win/2016/06/14/%E7%AC%AC%E4%B8%80%E4%B8%AAjni%E7%A8%8B%E5%BA%8F/" target="_blank" rel="noopener">第一个ndk程序</a>。在程序运行起来之后，接下来主要是要讲讲这个方法中相关代码的含义。</p>
<h3 id="第一个程序分析"><a href="#第一个程序分析" class="headerlink" title="第一个程序分析"></a>第一个程序分析</h3><p>首先是引入了jni.h和string.h的头文件，作为jni的程序，引入jni的相关内容是必须的，同时，因为里面还用到了string的内容，所以也引入了string的头文件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;jni.h&gt;</span><br><span class="line">#include &lt;string&gt;</span><br></pre></td></tr></table></figure>
<p>接下来是<code>extern &quot;C&quot;</code>，这个表示该函数实现 C 和 C++ 的混合编程，用于 C++ 代码调用 C 的函数。</p>
<p>然后看看具体的函数：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JNIEXPORT jstring</span><br><span class="line">JNICALL</span><br><span class="line">Java_library_whitelife_hellojni_JniUtil_getString(</span><br><span class="line">         JNIEnv *env,</span><br><span class="line">         jobject /* this */) &#123;</span><br><span class="line">     std::string hello = &quot;哈哈哈哈&quot;;</span><br><span class="line">     return env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先是第一句<code>JNIEXPORT jstring</code>。<code>JNIEXPORT</code>是一个宏定义，表明该函数可被外部调用，不定义时，默认也可以被外部调用，同时调用后返回jstring。</p>
<p>jni里面一共有9中基本数据类型：jbyte、jchar、jshort、jint、jlong、jfloat、jdouble、jboolean、jstring，它们对应的java数据类型一目了然。</p>
<p><code>JNICALL</code>也是一个宏定义，表示该函数是jni函数，当然，省略不写也没有影响。</p>
<p>然后看函数的名字：<code>Java_library_whitelife_hellojni_JniUtil_getString</code>。函数的名字很长，这是必须的。首先是表明该函数有java调用，调用的类第<code>library_whitelife_hellojni_JniUtil</code>，java类的完整路径，最后才是调用的natice方法名getstring，这些元素缺一不可。</p>
<p>再看传递的参数，一个是<code>JNIEnv</code> 指针，一个是<code>jobject</code>。<code>JNIEnv</code>是在jni.h中定义的结构体，表示jni环境，后续所有的jni接口都在里面，<code>jobject</code>是调用者的对象。同时这里可以看到，<code>jobject</code>后面没有具体的参数，这是一种省略的写法，后续如果要用到jobject，可以用this表示，当然你也可以自己补上jobject jo，然后操作jo。</p>
<p>看到这里，所有的jni方法都会有<code>JNIEnv</code>和<code>jobject</code>吗？不是。当java层中的native方法为static方法时，会传入JNIEnv和jclass，jcalss表示的是调用的类。同时由于该方法在调用时不带参数，如果携带相关参数的话，jni方法也会有相关的参数，当然参数类型为转为jni的类型。</p>
<p>然后看具体的代码：</p>
<p><code>std::string hello = &quot;哈哈哈哈&quot;;</code> <code>std::</code>是c++的命名空间，关于这方面的内容会在后续关于c++的文章中介绍。这个代码的意思相当于定义了一个string数据；然后调用了JNIEnv终端的函数<code>env-&gt;NewStringUTF(hello.c_str());</code>。<code>NewStringUTF</code>是jni的方法，它通过传入字符串返回一个jstring对象，而c_str()函数则将string对象变成字符串</p>
<h3 id="查看JNI方法"><a href="#查看JNI方法" class="headerlink" title="查看JNI方法"></a>查看JNI方法</h3><p>之前讲过，后续的jni方法基本都是通过JNIEnv来调用的，那么到底有哪些方法呢？首先你当然可以通过jni.h查看里面的源码，但是该文件很大，你可能很多的函数不一定能很快找到。最好的方式是通过java官网中的文档来查看相关的jni接口<a href="https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/jniTOC.html" target="_blank" rel="noopener">jni文档</a>。里面包含了很多jni相关的概念，函数等相关内容。</p>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ndk/">ndk</a><span class="tag-list-count">4</span></li></ul></div><div class="categories"><i class="icon icon-category"></i><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ndk/">ndk</a><span class="category-list-count">4</span></li></ul></div></div><div class="article-comment" style="max-width:800px"><div class="ds-thread" id="ds-thread" data-thread-key="ck85r7lsp002afxo1mm655066" data-title="NDK学习笔记(一)" data-url="https://earthwo.github.io/2016/12/24/jni学习笔记/" site-name="ueibo"></div><script>var siteName = document.getElementById('ds-thread').getAttribute('site-name');
var duoshuoQuery = {short_name: siteName};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2016/12/26/NDK学习笔记-二/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2016/12/07/ThreadLocal解析/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/earthWo" title="Github" target="_blank"><i class="icon icon-github"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2020 alonealice<br><small><a href="http://www.beian.miit.gov.cn" target="_blank">浙ICP备17033688号</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>